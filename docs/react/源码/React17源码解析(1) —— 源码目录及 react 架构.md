---
theme: smartblue
highlight: a11y-dark
---

æ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹  react æºç ï¼Œæœ¬ç³»åˆ—å¯¼èˆªè¯·è§ï¼š[React17 æºç è§£æ(å¼€ç¯‡) â€”â€” æ­å»º react æºç è°ƒè¯•ç¯å¢ƒ](https://juejin.cn/post/7014775797596553230/)

<hr />

è¦å­¦ä¹  react æºç ï¼Œé¦–å…ˆè¦å¯¹ react çš„æºç å’Œæ•´ä¸ªæ¶æ„æœ‰ä¸ªå¤§ä½“çš„äº†è§£ï¼Œè¿™æ ·å­¦èµ·æ¥ä¼šäº‹åŠåŠŸå€ã€‚æœ¬ç« å°†ä»‹ç»ä¸€ä¸‹ react çš„æºç å’Œæ¶æ„ã€‚

# æºç ç›®å½•

react çš„æºç ç›®å½•å¦‚ä¸‹ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼š

- fixturesï¼šä¸€äº›æµ‹è¯• demoï¼Œæ–¹ä¾¿ react ç¼–ç æ—¶çš„æµ‹è¯•
- packagesï¼šreact çš„ä¸»è¦æºç å†…å®¹
- scriptï¼šå’Œ react æ‰“åŒ…ã€ç¼–è¯‘ã€æœ¬åœ°å¼€å‘ç›¸å…³çš„å‘½ä»¤
  æˆ‘ä»¬è¦æ¢ç©¶çš„æºç å†…å®¹ï¼Œéƒ½å­˜æ”¾åœ¨ packages æ–‡ä»¶å¤¹ä¸‹:

```
ğŸ“¦react
 â”£ ğŸ“‚fixtures
 â”£ ğŸ“‚packages
 â”ƒ â”£ ğŸ“‚create-subscription
 â”ƒ â”£ ğŸ“‚dom-event-testing-library
 â”ƒ â”£ ğŸ“‚eslint-plugin-react-hooks
 â”ƒ â”£ ğŸ“‚jest-mock-scheduler
 â”ƒ â”£ ğŸ“‚jest-react
 â”ƒ â”£ ğŸ“‚react
 â”ƒ â”£ ğŸ“‚react-art
 â”ƒ â”£ ğŸ“‚react-cache
 â”ƒ â”£ ğŸ“‚react-client
 â”ƒ â”£ ğŸ“‚react-debug-tools
 â”ƒ â”£ ğŸ“‚react-devtools
 â”ƒ â”£ ğŸ“‚react-devtools-core
 â”ƒ â”£ ğŸ“‚react-devtools-extensions
 â”ƒ â”£ ğŸ“‚react-devtools-inline
 â”ƒ â”£ ğŸ“‚react-devtools-scheduling-profiler
 â”ƒ â”£ ğŸ“‚react-devtools-shares
 â”ƒ â”£ ğŸ“‚react-devtools-shell
 â”ƒ â”£ ğŸ“‚react-dom
 â”ƒ â”£ ğŸ“‚react-fetch
 â”ƒ â”£ ğŸ“‚react-interactions
 â”ƒ â”£ ğŸ“‚react-is
 â”ƒ â”£ ğŸ“‚react-native-renderer
 â”ƒ â”£ ğŸ“‚react-noop-renderer
 â”ƒ â”£ ğŸ“‚react-reconciler
 â”ƒ â”£ ğŸ“‚react-refresh
 â”ƒ â”£ ğŸ“‚react-server
 â”ƒ â”£ ğŸ“‚react-test-renderer
 â”ƒ â”£ ğŸ“‚react-transport-dom-relay
 â”ƒ â”£ ğŸ“‚react-transport-dom-webpack
 â”ƒ â”£ ğŸ“‚scheduler
 â”ƒ â”£ ğŸ“‚shared
 â”ƒ â”— ğŸ“‚use-subscription
 â”— ğŸ“‚scripts
```

æ ¹æ® packages ä¸‹é¢å„ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½ï¼Œæˆ‘å°†å…¶åˆ’åˆ†ä¸ºäº†å‡ ä¸ªæ¨¡å—ï¼š

## æ ¸å¿ƒ api

react çš„æ ¸å¿ƒ api éƒ½ä½äº `packages/react` æ–‡ä»¶å¤¹ä¸‹ï¼ŒåŒ…æ‹¬ `createElement`ã€`memo`ã€`context` ä»¥åŠ hooks ç­‰ï¼Œå‡¡æ˜¯é€šè¿‡ react åŒ…å¼•å…¥çš„ apiï¼Œéƒ½ä½äºæ­¤æ–‡ä»¶å¤¹ä¸‹ã€‚

## è°ƒåº¦å’Œåè°ƒ

è°ƒåº¦å’Œåè°ƒæ˜¯ react16 fiber å‡ºç°åçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå’Œä»–ä»¬ç›¸å…³çš„åŒ…å¦‚ä¸‹ï¼š

- schedulerï¼šå¯¹ä»»åŠ¡è¿›è¡Œè°ƒåº¦ï¼Œæ ¹æ®ä¼˜å…ˆçº§æ’åº
- react-concilerï¼šdiff ç®—æ³•ç›¸å…³ï¼Œå¯¹ fiber è¿›è¡Œå‰¯ä½œç”¨æ ‡è®°

## æ¸²æŸ“

å’Œæ¸²æŸ“ç›¸å…³çš„å†…å®¹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªç›®å½•ï¼š

- react-artï¼šcanvasã€svg ç­‰å†…å®¹çš„æ¸²æŸ“
- react-domï¼šæµè§ˆå™¨ç¯å¢ƒä¸‹çš„æ¸²æŸ“ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ¬ç³»åˆ—ä¸­ä¸»è¦æ¶‰åŠè®²è§£çš„æ¸²æŸ“çš„åŒ…
- react-native-rendererï¼šç”¨äºåŸç”Ÿç¯å¢ƒæ¸²æŸ“ç›¸å…³
- react-noop-rendererï¼šç”¨äºè°ƒè¯•ç¯å¢ƒçš„æ¸²æŸ“

## è¾…åŠ©åŒ…

- sharedï¼šå®šä¹‰äº† react çš„å…¬å…±æ–¹æ³•å’Œå˜é‡
- react-isï¼šreact ä¸­çš„ç±»å‹åˆ¤æ–­

## å…¶ä»–

å…¶ä»–çš„åŒ…å’Œæœ¬æ¬¡ react æºç æ¢ç©¶çš„å…³è”ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥ä¸è¿‡å¤šä»‹ç»äº†ã€‚

# react æ¶æ„

äº†è§£äº† react æºç ç›®å½•ä¹‹åï¼Œæˆ‘ä»¬å†æ¥å¯¹ react æ¶æ„æœ‰ä¸ªå¤§ä½“çš„è®¤è¯†ï¼Œäº†è§£ react æ˜¯å¦‚ä½•åœ¨å˜é‡æ›´æ”¹æ—¶ï¼Œé¡µé¢å‘ç”Ÿæ›´æ–°æ¸²æŸ“çš„ã€‚

react ä¸ºäº†ä¿è¯é¡µé¢èƒ½å¤Ÿæµç•…æ¸²æŸ“ï¼Œreact16 ä¹‹åçš„æ›´æ–°è¿‡ç¨‹åˆ†ä¸º render å’Œ commit ä¸¤ä¸ªé˜¶æ®µã€‚render é˜¶æ®µåŒ…æ‹¬ Scheduler(è°ƒåº¦å™¨) å’Œ Reconciler(åè°ƒå™¨)ï¼Œcommit é˜¶æ®µåŒ…æ‹¬ Renderer(æ¸²æŸ“å™¨)ï¼š

<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d958db1f965f44ce9bd4897717334ddd~tplv-k3u1fbpfcp-watermark.image?" width="100%" />

## è§¦å‘æ›´æ–°

è§¦å‘æ›´æ–°çš„æ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š`ReactDOM.render`(åŒ…æ‹¬é¦–æ¬¡æ¸²æŸ“)ã€`setState`ã€`forUpdate`ã€hooks ä¸­çš„ `useState` ä»¥åŠ ref çš„æ”¹å˜ç­‰å¼•èµ·çš„ã€‚

## scheduler

å½“é¦–æ¬¡æ¸²æŸ“æˆ–è€…ç»„ä»¶çŠ¶æ€å‘ç”Ÿæ›´æ–°ç­‰æƒ…å†µæ—¶ï¼Œæ­¤æ—¶é¡µé¢å°±è¦å‘ç”Ÿæ¸²æŸ“äº†ã€‚scheduler è¿‡ç¨‹ä¼šå¯¹è¯¸å¤šçš„ä»»åŠ¡è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œè®©æµè§ˆå™¨çš„æ¯ä¸€å¸§ä¼˜å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚åŠ¨ç”»ã€ç”¨æˆ·ç‚¹å‡»è¾“å…¥äº‹ä»¶ç­‰ï¼‰ï¼Œä»è€Œé˜²æ­¢ react çš„æ›´æ–°ä»»åŠ¡å¤ªå¤§å½±å“åˆ°ç”¨æˆ·äº¤äº’ï¼Œä¿è¯äº†é¡µé¢çš„æµç•…æ€§ã€‚

## reconciler

reconciler è¿‡ç¨‹ä¸­ï¼Œä¼šå¼€å§‹æ ¹æ®ä¼˜å…ˆçº§æ‰§è¡Œæ›´æ–°ä»»åŠ¡ã€‚è¿™ä¸€è¿‡ç¨‹ä¸»è¦æ˜¯æ ¹æ®æœ€æ–°çŠ¶æ€æ„å»ºæ–°çš„ fiber æ ‘ï¼Œä¸ä¹‹å‰çš„ fiber æ ‘è¿›è¡Œ diff å¯¹æ¯”ï¼Œå¯¹ fiber èŠ‚ç‚¹æ ‡è®°ä¸åŒçš„å‰¯ä½œç”¨ï¼Œå¯¹åº”æ¸²æŸ“è¿‡ç¨‹ä¸­çœŸå® dom çš„å¢åˆ æ”¹ã€‚ï¼ˆè¿™é‡Œä¸äº†è§£ fiber å’Œ diff çš„è¯æ²¡å…³ç³»ï¼Œåé¢ä¼šè®²åˆ°ï¼Œä¸»è¦æ˜¯å¯¹ react çš„æµç¨‹æœ‰ä¸ªå¤§è‡´æ¦‚å¿µï¼‰

## commit

åœ¨ render é˜¶æ®µä¸­ï¼Œæœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ª effectList æ•°ç»„ï¼Œè®°å½•äº†é¡µé¢çœŸå® dom çš„æ–°å¢ã€åˆ é™¤å’Œæ›¿æ¢ç­‰ä»¥åŠä¸€äº›äº‹ä»¶å“åº”ï¼Œcommit ä¼šæ ¹æ® effectList å¯¹çœŸå®çš„é¡µé¢è¿›è¡Œæ›´æ–°ï¼Œä»è€Œå®ç°é¡µé¢çš„æ”¹å˜ã€‚

ä»¥ä¸Šå¤§ä½“å°±æ˜¯ react æ›´æ–°è¿‡ç¨‹ä¸­çš„æ¶æ„ï¼Œå…·ä½“çš„ç»†èŠ‚è®²è§£ä¼šåœ¨åé¢çš„ç« èŠ‚ä¸­è¯¦ç»†è®²è¿°ï¼Œæ¬¢è¿å…³æ³¨æœ¬ä¸“æ ã€‚
